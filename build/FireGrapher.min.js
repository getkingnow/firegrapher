var FireGrapher=function(){"use strict";return FireGrapher=function(){},FireGrapher.prototype.graph=function(i,t,o){this.cssSelector=i,this.firebaseRef=t,this.updateConfig(o),this.drawGraph();var r=o.path.split("/");this.parsePathNode(["/"],r,0).then(function(i){console.log("Parsed paths: "+i),i.forEach(function(i){var t=i.split("/"),r=t[t.length-2];switch(this.config.type){case"table":this.firebaseRef.child(i).on("value",function(i){var t=i.val(),o=[];this.config.columnValues.forEach(function(i){o.push(t[i])}),this.addToTable(o)}.bind(this));break;case"line":this.firebaseRef.child(i).on("child_added",function(i){var t=i.val();console.log(this),line="$"===this.config.line[0]?r:t[o.line],this.addToLineGraph({line:line,xCoord:t[o.xCoord.value],yCoord:t[o.yCoord.value]})}.bind(this))}}.bind(this))}.bind(this))},FireGrapher.prototype.parsePathNode=function(i,t,o){return new RSVP.Promise(function(r){var e=t[o];if("*"===e[0])console.assert(o===t.length-1,"WHATTTT?"),console.log(o+": individual record"),r(i);else if("$"===e[0]){console.log(o+": param");var h=[];i.forEach(function(i){h.push(new RSVP.Promise(function(t){this.firebaseRef.child(i).once("value",function(o){var r=[];o.forEach(function(t){r.push(i+t.name()+"/")}.bind(this)),t(r)}.bind(this))}.bind(this)))}.bind(this)),new RSVP.all(h).then(function(i){var e=[];i.forEach(function(i){i.forEach(function(i){e.push(i)})}),this.parsePathNode(e,t,o+1).then(function(i){r(i)})}.bind(this))}else{console.log(o+": regular node");var n=[];i.forEach(function(i){n.push(i+=e+"/")}),this.parsePathNode(n,t,o+1).then(function(i){r(i)})}}.bind(this))},FireGrapher.prototype.addToTable=function(i){console.log(i)},FireGrapher.prototype.addToLineGraph=function(i){"undefined"==typeof this.graphData[i.line]&&(this.graphData[i.line]=[]);for(var t=this.graphData[i.line].length;t<i.xCoord;t++)this.graphData[i.line][t]=null;this.graphData[i.line][parseInt(i.xCoord)]=parseInt(i.yCoord);var o={xCoord:{},yCoord:{}};this.config.xCoord.min>i.xCoord&&(o.xCoord.min=i.xCoord),this.config.xCoord.max<i.xCoord&&(o.xCoord.max=i.xCoord),this.config.yCoord.min>i.yCoord&&(o.yCoord.min=i.yCoord),this.config.yCoord.max<i.yCoord&&(o.yCoord.max=i.yCoord),this.updateConfig(o),(o.xCoord.min||o.xCoord.max||o.yCoord.min||o.yCoord.max)&&this.renderGraph();var r=this.graphLines[i.line];"undefined"==typeof r?r=this.addLineToGraph(i.line,this.graphData[i.line]):this.graph.select(this.cssSelector+" path."+i.line).data([this.graphData[i.line]]).attr("d",r),console.log(this.graphData[i.line])},FireGrapher.prototype.updateConfig=function(i){if(this.config=this.config?this.config:{},this.config.type=this.config.type?this.config.type:null,this.config.graph=this.config.graph?this.config.graph:{},this.config.xCoord=this.config.xCoord?this.config.xCoord:{},this.config.yCoord=this.config.yCoord?this.config.yCoord:{},this.config.type=i.type&&-1!==["table","line","scatter"].indexOf(i.type)?i.type:this.config.type?this.config.type:null,null===this.config.type)throw new Error('Invalid chart type. Must be "table", "line", or "scatter"');this.config.graph={width:i.graph&&i.graph.width?i.graph.width:this.config.graph.width?this.config.graph.width:500,height:i.graph&&i.graph.height?i.graph.height:this.config.graph.height?this.config.graph.height:150},this.config.xCoord={min:i.xCoord&&i.xCoord.min?i.xCoord.min:this.config.xCoord.min?this.config.xCoord.min:0,max:i.xCoord&&i.xCoord.max?i.xCoord.max:this.config.xCoord.max?this.config.xCoord.max:50},this.config.yCoord={min:i.yCoord&&i.yCoord.min?i.yCoord.min:this.config.yCoord.min?this.config.yCoord.min:0,max:i.yCoord&&i.yCoord.max?i.yCoord.max:this.config.yCoord.max?this.config.yCoord.max:200}},FireGrapher.prototype.renderGraph=function(){for(console.log("Config has changed, syncing."),this.interpolateXCoord=d3.scale.linear().domain([this.config.xCoord.min,this.config.xCoord.max]).range([0,this.config.graph.width]),this.interpolateYCoord=d3.scale.linear().domain([this.config.yCoord.min,this.config.yCoord.max]).range([this.config.graph.height,0]),null!==this.graph.select(this.cssSelector+" g.x")[0][0]&&this.graph.select(this.cssSelector+" g.x").remove(),null!==this.graph.select(this.cssSelector+" g.y")[0][0]&&this.graph.select(this.cssSelector+" g.y").remove(),this.graph.append("g").attr("class","x axis").attr("transform","translate(0,"+this.config.graph.height+")").call(d3.svg.axis().scale(this.interpolateXCoord).ticks(4).tickSubdivide(1).tickSize(-this.config.graph.height,-this.config.graph.height,-50)).selectAll("text").attr("y",15).style("text-anchor","start"),this.graph.append("g").attr("class","y axis").call(d3.svg.axis().orient("left").scale(this.interpolateYCoord).ticks(8).tickSubdivide(0).tickSize(-this.config.graph.width,-this.config.graph.width,-50)).selectAll("text").attr("x",5).attr("y",-10).style("text-anchor","start");null!==this.graph.select(this.cssSelector+" path").remove()[0][0];);for(var i in this.graphLines)this.graphLines.hasOwnProperty(i)&&this.addLineToGraph(i,this.graphData[i])},FireGrapher.prototype.addLineToGraph=function(i){var t=d3.svg.line().defined(function(i){return null!=i}).x(function(i,t){return this.interpolateXCoord(t)}.bind(this)).y(function(i){return this.interpolateYCoord(i)}.bind(this)).interpolate("basis");this.graph.append("svg:path").attr("d",t(this.graphData[i])).attr("class",i),this.graphLines[i]=t},FireGrapher.prototype.drawGraph=function(){switch(this.config.type){case"table":this.drawTable();break;case"line":this.drawLineGraph()}},FireGrapher.prototype.drawLineGraph=function(){this.graphData={},this.graphLines={},this.graph=d3.select(this.cssSelector).append("svg:svg").attr("width","100%").attr("height","100%"),this.renderGraph()},FireGrapher.prototype.drawTable=function(){},FireGrapher}();"undefined"!=typeof module&&(module.exports=FireGrapher);