var FireGrapher=function(){"use strict";return FireGrapher=function(){},FireGrapher.prototype.graph=function(i,t,o){this.cssSelector=i,this.firebaseRef=t,this.validateConfig(o),this.config=o,this.setDefaultConfig(),this.drawGraph();var e=o.path.split("/");this.parsePathNode(["/"],e,0).then(function(i){console.log("Parsed paths: "+i),i.forEach(function(i){var t=i.split("/"),o=t[t.length-2];switch(this.config.type){case"table":this.firebaseRef.child(i).on("value",function(i){var t=i.val(),o=[];this.config.columns.forEach(function(i){o.push(t[i.value])}),this.addToTable(o)}.bind(this));break;case"line":this.firebaseRef.child(i).on("child_added",function(i){var t,e=i.val();t="$"===this.config.line[0]?o:e[this.config.line],this.addDataPointToLineGraph({line:t,xCoord:parseInt(e[this.config.xCoord.value]),yCoord:parseInt(e[this.config.yCoord.value])})}.bind(this))}}.bind(this))}.bind(this))},FireGrapher.prototype.parsePathNode=function(i,t,o){return new RSVP.Promise(function(e){var r=t[o];if(o===t.length&&e(i),"*"===r[0])console.assert(o===t.length-1,"WHATTTT?"),console.log(o+": individual record"),e(i);else if("$"===r[0]){console.log(o+": param");var n=[];i.forEach(function(i){n.push(new RSVP.Promise(function(t){this.firebaseRef.child(i).once("value",function(o){var e=[];o.forEach(function(t){e.push(i+t.name()+"/")}.bind(this)),t(e)}.bind(this))}.bind(this)))}.bind(this)),new RSVP.all(n).then(function(i){var r=[];i.forEach(function(i){i.forEach(function(i){r.push(i)})}),this.parsePathNode(r,t,o+1).then(function(i){e(i)})}.bind(this))}else{console.log(o+": regular node");var a=[];i.forEach(function(i){a.push(i+=r+"/")}),this.parsePathNode(a,t,o+1).then(function(i){e(i)})}}.bind(this))},FireGrapher.prototype.addToTable=function(i){console.log(i)},FireGrapher.prototype.addDataPointToLineGraph=function(i){"undefined"==typeof this.graphData[i.line]&&(this.graphData[i.line]={coordinates:[]}),this.graphData[i.line].coordinates.push({x:i.xCoord,y:i.yCoord}),i.xCoord>this.graphData[i.line].coordinates[this.graphData[i.line].coordinates.length-2]&&this.graphData[i.line].coordinates.sort(function(i,t){return i.x-t.x});var t=!1;this.config.xCoord.min>i.xCoord&&(this.config.xCoord.min=i.xCoord,t=!0),this.config.xCoord.max<i.xCoord&&(this.config.xCoord.max=i.xCoord,t=!0),this.config.yCoord.min>i.yCoord&&(this.config.yCoord.min=i.yCoord,t=!0),this.config.yCoord.max<i.yCoord&&(this.config.yCoord.max=i.yCoord,t=!0),t&&this.renderGraph();var o=this.graphLines[i.line];"undefined"==typeof o?o=this.addLineToGraph(i.line,this.graphData[i.line].coordinates):(this.graph.select(this.cssSelector+" path."+i.line).data([this.graphData[i.line].coordinates]).attr("d",o),this.graph.append("circle").attr("class","dot "+i.line).attr("cx",this.interpolateXCoord(i.xCoord)).attr("cy",this.interpolateYCoord(i.yCoord)).attr("r",3.5))},FireGrapher.prototype.validateConfig=function(i){var t=["table","line","scatter"];if("undefined"==typeof i.type)throw new Error('No graph "type" specified. Must be "table", "line", or "scatter"');if(-1===t.indexOf(i.type))throw new Error('Invalid graph "type" specified. Must be "table", "line", or "scatter"');if("undefined"==typeof i.path)throw new Error('No "path" to individual record specified.');switch(i.type){case"table":if("undefined"==typeof i.columns)throw new Error('No table "columns" specified.');i.columns.forEach(function(i){if("undefined"==typeof i.label)throw new Error('Missing "columns" label.');if("undefined"==typeof i.value)throw new Error('Missing "columns" value.')});break;case"line":if("undefined"==typeof i.xCoord)throw new Error('No "xCoord" specified.');if("undefined"==typeof i.yCoord)throw new Error('No "yCoord" specified.');break;case"scatter":}},FireGrapher.prototype.setDefaultConfig=function(){"line"===this.config.type&&(this.config.graph=this.config.graph?this.config.graph:{},this.config.graph.width=this.config.graph.width?this.config.graph.width:500,this.config.graph.height=this.config.graph.height?this.config.graph.height:150,this.config.xCoord.min=this.config.xCoord.min?this.config.xCoord.min:0,this.config.xCoord.max=this.config.xCoord.max?this.config.xCoord.max:50,this.config.yCoord.min=this.config.yCoord.min?this.config.yCoord.min:0,this.config.yCoord.max=this.config.yCoord.max?this.config.yCoord.max:200)},FireGrapher.prototype.renderGraph=function(){for(this.interpolateXCoord=d3.scale.linear().domain([this.config.xCoord.min,this.config.xCoord.max]).range([0,this.config.graph.width]),this.interpolateYCoord=d3.scale.linear().domain([this.config.yCoord.min,this.config.yCoord.max]).range([this.config.graph.height,0]);null!==this.graph.select(this.cssSelector+" g").remove()[0][0];);for(this.graph.append("g").attr("class","x axis").attr("transform","translate(0,"+this.config.graph.height+")").call(d3.svg.axis().scale(this.interpolateXCoord).ticks(4).tickSubdivide(1).tickSize(-this.config.graph.height,-this.config.graph.height,-50)).selectAll("text").attr("y",15).style("text-anchor","start"),this.graph.append("g").attr("class","y axis").call(d3.svg.axis().orient("left").scale(this.interpolateYCoord).ticks(8).tickSubdivide(0).tickSize(-this.config.graph.width,-this.config.graph.width,-50)).selectAll("text").attr("x",5).attr("y",-10).style("text-anchor","start");null!==this.graph.select("path").remove()[0][0];);for(;null!==this.graph.select("circle").remove()[0][0];);for(var i in this.graphLines)this.graphLines.hasOwnProperty(i)&&this.addLineToGraph(i,this.graphData[i].coordinates)},FireGrapher.prototype.addLineToGraph=function(i,t){var o=d3.svg.line().defined(function(i){return null!==i}).x(function(i){return this.interpolateXCoord(i.x)}.bind(this)).y(function(i){return this.interpolateYCoord(i.y)}.bind(this)).interpolate("linear");this.graph.append("svg:path").attr("d",o(this.graphData[i].coordinates)).attr("class",i),this.graphLines[i]=o,this.graph.selectAll(this.cssSelector+" circle."+i).data(t).enter().append("circle").attr("class","dot "+i).attr("cx",o.x()).attr("cy",o.y()).attr("r",3.5)},FireGrapher.prototype.drawGraph=function(){switch(this.config.type){case"table":this.drawTable();break;case"line":this.drawLineGraph()}},FireGrapher.prototype.drawLineGraph=function(){this.graphData={},this.graphLines={},this.graph=d3.select(this.cssSelector).append("svg:svg").attr("width","100%").attr("height","100%"),this.renderGraph()},FireGrapher.prototype.drawTable=function(){},FireGrapher}();"undefined"!=typeof module&&(module.exports=FireGrapher);